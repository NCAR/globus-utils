#!/bin/bash
#
#   gci subcommand ls
#
#   Author:         Brian Vanderwende
#   Last Revised:   08:56, 14 Nov 2019
#

function usage {
cat << EOF
Usage: gci ls [OPTIONS] PATH

This command is used to list files and directories on the
campaign storage platform.
EOF
}

if [[ " $@ " == *" -h"* ]]; then
    usage
    exit 0
fi

# Add endpoint ID to the TARGET
for (( i=$#; i>0; i-- )); do
    KEY=${!i}

    if [[ ${TARGET}z == z ]]; then
        TARGET=$KEY
    else
        GTARGS="$KEY $GTARGS"
    fi
done

if [[ ${TARGET}z == z ]]; then
    echo "Must provide path to query on Campaign Storage!"
    exit 10
else
    [[ $TARGET != /gpfs/csfs1/* ]] && [[ $TARGET != $CSPREFIX/* ]] && TARGET=$CSPREFIX/$TARGET
    TARGET=$EPSTORE:$TARGET
fi

# Now call globus transfer
cat << EOF
Running command ...

globus ls $GTARGS
    $TARGET

EOF

[[ $DEBUG == true ]] && exit 0
globus ls $GTARGS $TARGET
