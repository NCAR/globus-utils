#!/bin/bash
#
#   gci subcommand mkdir
#
#   Author:         Brian Vanderwende
#   Last Revised:   13:12, 08 Nov 2019
#

function usage {
cat << EOF
Usage: gci mkdir [OPTIONS] PATH

This command can be used to create directories on the campaign
storage platform via Globus.
EOF
}

if [[ " $@ " == *" -h"* ]]; then
    usage
    exit 0
fi

# Add endpoint ID to the TARGET
for (( i=$#; i>0; i-- )); do
    KEY=${!i}

    if [[ ${TARGET}z == z ]]; then
        TARGET=$KEY
    else
        GTARGS="$KEY $GTARGS"
    fi
done

if [[ ${TARGET}z == z ]]; then
    echo "Must provide path to create on Campaign Storage!"
    exit 10
else
    [[ $TARGET != /gpfs/csfs1/* ]] && [[ $TARGET != /glade/campaign/* ]] && TARGET=/gpfs/csfs1/$TARGET
    TARGET=$EPSTORE:$TARGET
fi

# Now call globus transfer
cat << EOF
Running command ...

globus mkdir $GTARGS
    $TARGET

EOF

[[ $DEBUG == true ]] && exit 0
globus mkdir $GTARGS $TARGET
